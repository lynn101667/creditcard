<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2566">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="zh-TW"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;title&gt;æ¯›çˆ¸æ¯›åª½çš„ä¿¡ç”¨å¡æ¬Šç›Š V75&lt;/title&gt;</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;!-- PWA Settings --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;meta name="apple-mobile-web-app-capable" content="yes"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;meta name="apple-mobile-web-app-title" content="æ¯›çˆ¸æ¯›åª½æ¬Šç›Š"&gt;</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;!-- Custom Icon --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;link rel="icon" type="image/jpeg" href="https://drive.google.com/thumbnail?id=1wV-Acpnvj_3CXb_BHx4HPkLiLeqA6ItS&amp;sz=s256"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;link rel="apple-touch-icon" href="https://drive.google.com/thumbnail?id=1wV-Acpnvj_3CXb_BHx4HPkLiLeqA6ItS&amp;sz=s256"&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;script src="https://unpkg.com/lucide@latest"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&amp;family=Noto+Serif+TC:wght@400;600;700&amp;display=swap" rel="stylesheet"&gt;</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>tailwind.config = {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>theme: {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>extend: {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>colors: { aurora: { primary: '#6366F1', accent: '#EC4899' } },</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>fontFamily: { sans: ['"Noto Sans TC"', 'sans-serif'], serif: ['"Noto Serif TC"', 'serif'] },</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>boxShadow: { 'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.07)' },</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>animation: { 'shake': 'shake 0.82s cubic-bezier(.36,.07,.19,.97) both' },</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>keyframes: { shake: { '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' }, '20%, 80%': { transform: 'translate3d(2px, 0, 0)' }, '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' }, '40%, 60%': { transform: 'translate3d(4px, 0, 0)' } } }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>body { font-family: 'Noto Sans TC', sans-serif; -webkit-tap-highlight-color: transparent; background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%); background-attachment: fixed; min-height: 100vh; overscroll-behavior-y: none; padding-bottom: env(safe-area-inset-bottom); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>h1, h2, h3, .serif-font { font-family: 'Noto Serif TC', serif; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.fade-in { animation: fadeIn 0.3s ease-out; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>@keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.6); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.custom-checkbox input:checked + div { background-color: #6366F1; border-color: #6366F1; color: white; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.tab-btn { color: #94A3B8; transition: all 0.3s; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.tab-btn.active { color: #6366F1; transform: translateY(-2px); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.fab { background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%); box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.loading-overlay { background: rgba(255,255,255,0.9); backdrop-filter: blur(5px); z-index: 100; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>button { pointer-events: auto; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.tx-row { transition: background-color 0.2s; cursor: pointer; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.tx-row:active { background-color: #F1F5F9; transform: scale(0.98); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.bank-badge { display: inline-block; padding: 0.35rem 0.8rem; border-radius: 9999px; color: white; font-weight: bold; font-size: 0.75rem; box-shadow: 0 2px 6px rgba(0,0,0,0.15); letter-spacing: 0.5px; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.input-box-fixed { background-color: #F8FAFC; border: 1px solid #E2E8F0; border-radius: 1.2rem; padding: 0.75rem 1rem; display: flex; align-items: center; width: 100%; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>select { -webkit-appearance: none; appearance: none; background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2394A3B8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 1rem center; background-size: 1em; border-radius: 1rem; }</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.float-btn-group { position: fixed; bottom: 85px; right: 20px; display: flex; flex-direction: column; gap: 10px; z-index: 45; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.float-mini-btn { width: 44px; height: 44px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.3s; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.btn-top { background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.15); color: #6366F1; opacity: 0; transform: translateY(10px); pointer-events: none; border: 1px solid #EEF2FF; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.btn-top.show { opacity: 1; transform: translateY(0); pointer-events: auto; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.btn-bot { background: linear-gradient(135deg, #EC4899 0%, #F43F5E 100%); box-shadow: 0 4px 12px rgba(236, 72, 153, 0.4); color: white; transform: scale(0); transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.btn-bot.show { transform: scale(1); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.btn-bot:active { transform: scale(0.9); }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.toggle-checkbox:checked { right: 0; border-color: #68D391; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.toggle-checkbox:checked + .toggle-label { background-color: #68D391; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.toggle-switch { position: relative; width: 40px; height: 22px; background: #CBD5E0; border-radius: 20px; transition: 0.3s; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.toggle-switch::after { content: ''; position: absolute; top: 2px; left: 2px; width: 18px; height: 18px; background: white; border-radius: 50%; transition: 0.3s; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.toggle-checked { background: #6366F1; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.toggle-checked::after { transform: translateX(18px); }</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.suggestions-box { position: absolute; top: 100%; left: 0; width: 100%; background: white; border: 1px solid #E2E8F0; border-radius: 1rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); z-index: 50; max-height: 250px; overflow-y: auto; margin-top: 4px; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.suggestion-item { padding: 0.75rem 1rem; cursor: pointer; font-size: 0.875rem; color: #475569; border-bottom: 1px solid #F1F5F9; display:flex; justify-content:space-between; align-items:center; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.suggestion-item:last-child { border-bottom: none; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.suggestion-item:hover { background-color: #F8FAFC; color: #6366F1; font-weight: bold; }</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.pin-dot { width: 12px; height: 12px; border-radius: 50%; background-color: #CBD5E0; margin: 0 4px; transition: background-color 0.2s; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.pin-dot.active { background-color: #6366F1; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body class="pb-24 text-slate-700"&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;!-- Login Screen --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div id="loginScreen" class="fixed inset-0 z-[100] bg-gradient-to-br from-indigo-50 to-pink-50 flex flex-col items-center justify-center p-6 transition-all duration-500"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="bg-white/80 backdrop-blur-xl p-8 rounded-[2rem] shadow-xl w-full max-w-xs text-center border border-white/50"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;h1 class="text-2xl font-bold text-slate-800 mb-2 serif-font"&gt;æ­¡è¿å›ä¾†&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;p class="text-xs text-slate-400 mb-8"&gt;è«‹é¸æ“‡èº«åˆ†ä»¥è§£é–&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;div id="userSelectArea" class="grid grid-cols-2 gap-4 mb-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onclick="promptPin('Lynn')" class="flex flex-col items-center gap-3 p-4 rounded-2xl border-2 border-transparent bg-white shadow-sm hover:border-pink-300 transition-all hover:-translate-y-1 active:scale-95 group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="w-16 h-16 rounded-full bg-pink-100 flex items-center justify-center text-4xl shadow-inner group-hover:scale-110 transition-transform"&gt;ğŸ±&lt;/div&gt;&lt;span class="font-bold text-slate-600"&gt;Lynn&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onclick="promptPin('Andy')" class="flex flex-col items-center gap-3 p-4 rounded-2xl border-2 border-transparent bg-white shadow-sm hover:border-blue-300 transition-all hover:-translate-y-1 active:scale-95 group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="w-16 h-16 rounded-full bg-blue-100 flex items-center justify-center text-4xl shadow-inner group-hover:scale-110 transition-transform"&gt;ğŸ¦&lt;/div&gt;&lt;span class="font-bold text-slate-600"&gt;Andy&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;div id="pinArea" class="hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="flex items-center justify-center gap-2 mb-6"&gt;&lt;div class="w-12 h-12 rounded-full bg-indigo-100 flex items-center justify-center text-2xl shadow-sm" id="pinUserIcon"&gt;&lt;/div&gt;&lt;span class="font-bold text-lg text-slate-700" id="pinUserName"&gt;&lt;/span&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="flex justify-center mb-6" id="pinDots"&gt;&lt;div class="pin-dot"&gt;&lt;/div&gt;&lt;div class="pin-dot"&gt;&lt;/div&gt;&lt;div class="pin-dot"&gt;&lt;/div&gt;&lt;div class="pin-dot"&gt;&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="grid grid-cols-3 gap-3 mb-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onclick="addPin(1)" class="py-3 rounded-2xl bg-slate-50 font-bold text-lg shadow-sm hover:bg-white active:bg-indigo-50"&gt;1&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onclick="addPin(2)" class="py-3 rounded-2xl bg-slate-50 font-bold text-lg shadow-sm hover:bg-white active:bg-indigo-50"&gt;2&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onclick="addPin(3)" class="py-3 rounded-2xl bg-slate-50 font-bold text-lg shadow-sm hover:bg-white active:bg-indigo-50"&gt;3&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onclick="addPin(4)" class="py-3 rounded-2xl bg-slate-50 font-bold text-lg shadow-sm hover:bg-white active:bg-indigo-50"&gt;4&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onclick="addPin(5)" class="py-3 rounded-2xl bg-slate-50 font-bold text-lg shadow-sm hover:bg-white active:bg-indigo-50"&gt;5&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onclick="addPin(6)" class="py-3 rounded-2xl bg-slate-50 font-bold text-lg shadow-sm hover:bg-white active:bg-indigo-50"&gt;6&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onclick="addPin(7)" class="py-3 rounded-2xl bg-slate-50 font-bold text-lg shadow-sm hover:bg-white active:bg-indigo-50"&gt;7&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onclick="addPin(8)" class="py-3 rounded-2xl bg-slate-50 font-bold text-lg shadow-sm hover:bg-white active:bg-indigo-50"&gt;8&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onclick="addPin(9)" class="py-3 rounded-2xl bg-slate-50 font-bold text-lg shadow-sm hover:bg-white active:bg-indigo-50"&gt;9&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onclick="resetPinUI()" class="py-3 rounded-2xl text-slate-400 font-bold text-xs"&gt;å–æ¶ˆ&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onclick="addPin(0)" class="py-3 rounded-2xl bg-slate-50 font-bold text-lg shadow-sm hover:bg-white active:bg-indigo-50"&gt;0&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onclick="deletePin()" class="py-3 rounded-2xl text-indigo-500"&gt;&lt;i data-lucide="delete" class="w-6 h-6 mx-auto"&gt;&lt;/i&gt;&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;!-- Main App --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div id="appContainer" class="hidden opacity-0 transition-opacity duration-500"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div id="toast" class="fixed top-4 left-1/2 -translate-x-1/2 bg-slate-800 text-white px-4 py-2 rounded-full text-xs font-bold shadow-lg z-[80] transition-opacity duration-300 opacity-0 pointer-events-none"&gt;âœ… å·²æ›´æ–°&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div id="loadingOverlay" class="fixed inset-0 loading-overlay hidden flex flex-col items-center justify-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;div class="relative w-16 h-16 mb-4"&gt;&lt;div class="absolute inset-0 border-4 border-indigo-100 rounded-full"&gt;&lt;/div&gt;&lt;div class="absolute inset-0 border-4 border-indigo-500 rounded-full border-t-transparent animate-spin"&gt;&lt;/div&gt;&lt;i data-lucide="cloud-upload" class="absolute inset-0 m-auto w-6 h-6 text-indigo-500 animate-pulse"&gt;&lt;/i&gt;&lt;/div&gt;&lt;span class="text-sm font-bold text-indigo-600 tracking-widest animate-pulse" id="loadingText"&gt;é›²ç«¯åŒæ­¥ä¸­...&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;!-- Header --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="sticky top-0 z-30 bg-white/80 backdrop-blur-md shadow-sm border-b border-white/50 transition-all duration-300"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;div class="max-w-md mx-auto px-5 py-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="flex justify-between items-center mb-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="flex items-center gap-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;h1 class="text-indigo-600 text-xl font-bold flex items-center gap-2 tracking-wide" onclick="window.scrollTo({top:0, behavior:'smooth'})"&gt;&lt;i data-lucide="paw-print" class="w-5 h-5 text-pink-500"&gt;&lt;/i&gt; &lt;span id="appTitle"&gt;æ¯›çˆ¸æ¯›åª½çš„ä¿¡ç”¨å¡æ¬Šç›Š&lt;/span&gt;&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;span id="userBadge" class="text-xs px-2.5 py-1 rounded-full bg-slate-100 text-slate-500 font-bold hidden shadow-sm border border-slate-200"&gt;&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div id="totalSpendDisplay" class="text-slate-500 text-xs font-bold bg-indigo-50 px-3 py-1.5 rounded-full border border-indigo-100 hidden"&gt;æœ¬æœŸ $0&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div id="headerControls" class="mt-2 space-y-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="relative bg-white rounded-xl shadow-sm border border-indigo-50 flex items-center"&gt;&lt;i data-lucide="search" class="absolute left-3 w-4 h-4 text-indigo-300"&gt;&lt;/i&gt;&lt;input type="text" id="searchInput" placeholder="æœå°‹æ¬Šç›Šã€é¤å»³ã€å„ªæƒ ..." class="w-full pl-10 pr-10 py-3 rounded-xl border-none outline-none bg-transparent text-slate-700 placeholder-indigo-200 text-sm font-medium"&gt;&lt;button id="clearBtn" class="absolute right-3 hidden text-slate-400 hover:text-indigo-500 p-1"&gt;&lt;i data-lucide="x" class="w-4 h-4"&gt;&lt;/i&gt;&lt;/button&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div id="quickSelectContainer" class="grid grid-cols-2 gap-3 fade-in"&gt;&lt;div class="relative"&gt;&lt;select id="bankSelect" class="w-full bg-white/60 border border-white/60 rounded-xl py-2 pl-3 pr-8 text-xs font-bold text-slate-600 outline-none focus:ring-1 focus:ring-indigo-300"&gt;&lt;option value=""&gt;æ‰€æœ‰éŠ€è¡Œ&lt;/option&gt;&lt;/select&gt;&lt;/div&gt;&lt;div class="relative"&gt;&lt;select id="cardSelect" class="w-full bg-white/60 border border-white/60 rounded-xl py-2 pl-3 pr-8 text-xs font-bold text-slate-600 outline-none disabled:opacity-50 focus:ring-1 focus:ring-indigo-300" disabled&gt;&lt;option value=""&gt;æ‰€æœ‰å¡ç‰‡&lt;/option&gt;&lt;/select&gt;&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div id="manageControls" class="mt-2 hidden fade-in space-y-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="flex items-center justify-between gap-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="flex items-center gap-2 cursor-pointer bg-indigo-50/50 p-2.5 rounded-xl border border-indigo-50 flex-1" onclick="toggleActiveOnly()"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div id="toggleActiveSwitch" class="toggle-switch flex-shrink-0"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;span class="text-xs font-bold text-slate-600"&gt;åƒ…é¡¯ç¤ºæ¶ˆè²»ä¿¡ç”¨å¡&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onclick="document.getElementById('cloudModal').classList.remove('hidden')" class="w-11 h-11 flex items-center justify-center bg-white border border-indigo-50 rounded-xl text-indigo-400 shadow-sm hover:text-indigo-600 active:scale-95 transition"&gt;&lt;i data-lucide="settings" class="w-5 h-5"&gt;&lt;/i&gt;&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="flex gap-2"&gt;&lt;div class="relative flex-1"&gt;&lt;select id="manageCardFilter" class="w-full bg-white/90 border border-indigo-100 rounded-xl py-2.5 pl-3 pr-8 text-xs font-bold text-slate-600 outline-none shadow-sm focus:ring-2 focus:ring-indigo-200"&gt;&lt;option value=""&gt;ğŸ’³ æ‰€æœ‰ä¿¡ç”¨å¡&lt;/option&gt;&lt;/select&gt;&lt;/div&gt;&lt;button onclick="window.openHistoryModal()" class="flex-none px-4 py-2.5 bg-indigo-500 text-white rounded-xl shadow-md text-xs font-bold flex items-center gap-1 active:scale-95 transition-transform hover:bg-indigo-600"&gt;&lt;i data-lucide="receipt" class="w-4 h-4"&gt;&lt;/i&gt; æ­·å²å¸³æœ¬&lt;/button&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div id="smallPayControls" class="hidden fade-in mt-2 space-y-3"&gt;&lt;div class="bg-white p-4 rounded-2xl border border-orange-100 shadow-sm relative"&gt;&lt;div class="flex justify-between items-start mb-2"&gt;&lt;div class="flex items-center gap-2"&gt;&lt;i data-lucide="shield-alert" class="w-5 h-5 text-orange-500"&gt;&lt;/i&gt;&lt;h2 class="text-sm font-bold text-slate-800"&gt;å°é¡æ”¯ä»˜å¹³å°æŸ¥è©¢&lt;/h2&gt;&lt;/div&gt;&lt;button onclick="document.getElementById('smallPayDbModal').classList.remove('hidden')" class="text-[10px] text-indigo-500 underline"&gt;æ‰‹å‹•åŒ¯å…¥&lt;/button&gt;&lt;/div&gt;&lt;div class="relative mb-3"&gt;&lt;div class="relative bg-slate-50 rounded-xl shadow-inner border border-slate-200 flex items-center"&gt;&lt;i data-lucide="search" class="absolute left-3 w-4 h-4 text-slate-400"&gt;&lt;/i&gt;&lt;input type="text" id="smallPayInput" placeholder="è¼¸å…¥å“ç‰Œ (å¦‚: é¶´èŒ¶æ¨“)..." autocomplete="off" class="w-full pl-10 pr-10 py-3 rounded-xl border-none outline-none bg-transparent text-slate-700 placeholder-slate-400 text-sm font-bold" oninput="onSmallPayInput(this.value)"&gt;&lt;button onclick="clearSmallPaySearch()" class="absolute right-3 text-slate-300 hover:text-slate-500 p-1"&gt;&lt;i data-lucide="x" class="w-4 h-4"&gt;&lt;/i&gt;&lt;/button&gt;&lt;/div&gt;&lt;div id="smallPaySuggestions" class="suggestions-box hidden"&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="relative"&gt;&lt;select id="smallPayCitySelect" onchange="filterSmallPayByCity()" class="w-full bg-orange-50/50 border border-orange-100 rounded-xl py-2.5 pl-3 pr-8 text-xs font-bold text-slate-600 outline-none focus:ring-2 focus:ring-orange-200"&gt;&lt;option value=""&gt;ğŸ™ï¸ ä¾ç¸£å¸‚æŸ¥è©¢åº—å®¶&lt;/option&gt;&lt;/select&gt;&lt;/div&gt;&lt;/div&gt;&lt;div id="smallPayResult" class="hidden animate-in fade-in slide-in-from-top-2"&gt;&lt;/div&gt;&lt;div class="text-[10px] text-slate-300 text-center mt-2" id="smallPayStats"&gt;è³‡æ–™è¼‰å…¥ä¸­...&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;!-- Floating Buttons --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="float-btn-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;button id="btnAiBot" onclick="openAiChat()" class="float-mini-btn btn-bot hidden"&gt;&lt;i data-lucide="bot" class="w-6 h-6"&gt;&lt;/i&gt;&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;button id="btnBackToTop" onclick="window.scrollTo({top:0, behavior:'smooth'})" class="float-mini-btn btn-top"&gt;&lt;i data-lucide="arrow-up" class="w-5 h-5"&gt;&lt;/i&gt;&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div id="mainContent" class="max-w-md mx-auto px-4 pt-4 space-y-5 min-h-[60vh]"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div id="noResult" class="hidden text-center py-20 opacity-60"&gt;&lt;div class="bg-white/50 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 shadow-sm backdrop-blur-sm"&gt;&lt;i data-lucide="cloud-off" class="w-10 h-10 text-indigo-200"&gt;&lt;/i&gt;&lt;/div&gt;&lt;p class="text-indigo-400 font-bold text-sm tracking-widest"&gt;æš«ç„¡ç¬¦åˆè³‡æ–™&lt;/p&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="fixed bottom-0 left-0 w-full bg-white/90 backdrop-blur-xl border-t border-indigo-50 z-40 pb-[env(safe-area-inset-bottom)]"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;div class="max-w-md mx-auto grid grid-cols-3 h-16 relative"&gt;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onclick="switchTab('search')" class="tab-btn flex flex-col items-center justify-center gap-1" id="btnSearch"&gt;&lt;i data-lucide="library" class="w-5 h-5"&gt;&lt;/i&gt;&lt;span class="text-[10px] font-bold tracking-wide"&gt;æ¬Šç›ŠæŸ¥è©¢&lt;/span&gt;&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onclick="switchTab('manage')" class="tab-btn active flex flex-col items-center justify-center gap-1" id="btnManage"&gt;&lt;i data-lucide="wallet-cards" class="w-5 h-5"&gt;&lt;/i&gt;&lt;span class="text-[10px] font-bold tracking-wide"&gt;å¸³å‹™ç®¡ç†&lt;/span&gt;&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onclick="switchTab('smallpay')" class="tab-btn flex flex-col items-center justify-center gap-1" id="btnSmallPay"&gt;&lt;i data-lucide="shield-alert" class="w-5 h-5"&gt;&lt;/i&gt;&lt;span class="text-[10px] font-bold tracking-wide"&gt;å°é¡æŸ¥è©¢&lt;/span&gt;&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div id="fabContainer" class="absolute left-1/2 -top-6 -translate-x-1/2 hidden fade-in z-50 pointer-events-auto" style="display:block;"&gt;&lt;button onclick="openTransactionModal()" class="fab text-white w-14 h-14 rounded-full flex items-center justify-center transition-transform active:scale-95 group pointer-events-auto shadow-xl"&gt;&lt;i data-lucide="plus" class="w-7 h-7"&gt;&lt;/i&gt;&lt;/button&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt; &lt;!-- End App Container --&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;!-- Modals --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div id="aiChatModal" class="fixed inset-0 bg-slate-900/60 z-[70] hidden flex flex-col justify-end sm:justify-center backdrop-blur-sm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="bg-white w-full sm:max-w-sm sm:mx-auto sm:rounded-3xl rounded-t-3xl h-[80vh] sm:h-[600px] flex flex-col shadow-2xl animate-in slide-in-from-bottom-10"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;div class="p-4 border-b border-slate-100 flex justify-between items-center bg-gradient-to-r from-pink-500 to-rose-500 text-white sm:rounded-t-3xl rounded-t-3xl"&gt;&lt;div class="flex items-center gap-2"&gt;&lt;i data-lucide="bot" class="w-6 h-6"&gt;&lt;/i&gt;&lt;h3 class="font-bold"&gt;AI æ™ºèƒ½å®¢æœ&lt;/h3&gt;&lt;/div&gt;&lt;button onclick="document.getElementById('aiChatModal').classList.add('hidden')" class="p-1 hover:bg-white/20 rounded-full transition"&gt;&lt;i data-lucide="x" class="w-5 h-5"&gt;&lt;/i&gt;&lt;/button&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;div class="flex-1 p-4 overflow-y-auto space-y-4 bg-slate-50" id="aiChatContent"&gt;&lt;div class="flex gap-3"&gt;&lt;div class="w-8 h-8 rounded-full bg-gradient-to-br from-pink-400 to-rose-400 flex items-center justify-center text-white flex-shrink-0"&gt;&lt;i data-lucide="bot" class="w-4 h-4"&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class="bg-white p-3 rounded-2xl rounded-tl-none shadow-sm text-sm text-slate-700 max-w-[80%]"&gt;ä½ å¥½ï¼æˆ‘æ˜¯æ‚¨çš„ä¿¡ç”¨å¡å°å¹«æ‰‹ã€‚&lt;br&gt;å‘Šè¨´æˆ‘æ‚¨æƒ³æ¶ˆè²»çš„é …ç›®ï¼Œä¾‹å¦‚ï¼šã€Œæƒ³å–&lt;b&gt;50åµ&lt;/b&gt;ã€ã€ã€Œè¦åƒ&lt;b&gt;è‚¯å¾·åŸº&lt;/b&gt;ã€ã€ã€Œç¹³&lt;b&gt;ä¿è²»&lt;/b&gt;ã€ï¼Œæˆ‘æœƒè‡ªå‹•å¹«æ‚¨æ‰¾é©åˆçš„å¡ç‰‡ï¼Œä¸¦å¹«æ‚¨æª¢æŸ¥æ˜¯å¦ç‚ºå°é¡æ”¯ä»˜å–”ï¼&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;div class="p-4 bg-white border-t border-slate-100 flex gap-2 pb-[calc(1rem+env(safe-area-inset-bottom))]"&gt;&lt;input type="text" id="aiInput" class="flex-1 bg-slate-100 border-none rounded-xl px-4 py-2.5 text-sm outline-none focus:ring-2 focus:ring-pink-200" placeholder="è¼¸å…¥ï¼šæˆ‘æƒ³å–å¯ä¸å¯..." onkeypress="if(event.key==='Enter') sendAiMessage()"&gt;&lt;button onclick="sendAiMessage()" class="bg-pink-500 text-white p-2.5 rounded-xl hover:bg-pink-600 transition"&gt;&lt;i data-lucide="send" class="w-4 h-4"&gt;&lt;/i&gt;&lt;/button&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div id="cloudModal" class="fixed inset-0 bg-slate-900/60 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="bg-white rounded-3xl p-6 w-full max-w-xs shadow-2xl fade-in text-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;h3 class="font-bold text-lg mb-4 text-slate-800 serif-font text-center"&gt;ä½¿ç”¨è€…è¨­å®š&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;div class="bg-indigo-50 p-4 rounded-xl mb-5 border border-indigo-100"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;label class="text-[10px] font-bold text-indigo-400 uppercase tracking-widest mb-3 block text-center"&gt;é¸æ“‡æ‚¨çš„èº«åˆ†&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="grid grid-cols-2 gap-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button id="btnUserLynn" onclick="switchUser('Lynn')" class="py-3 text-sm font-bold rounded-xl border border-slate-200 bg-white text-slate-500 hover:bg-pink-50 transition-all flex flex-col items-center gap-1 shadow-sm"&gt;&lt;span class="text-2xl mb-1"&gt;ğŸ±&lt;/span&gt; Lynn&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button id="btnUserAndy" onclick="switchUser('Andy')" class="py-3 text-sm font-bold rounded-xl border border-slate-200 bg-white text-slate-500 hover:bg-blue-50 transition-all flex flex-col items-center gap-1 shadow-sm"&gt;&lt;span class="text-2xl mb-1"&gt;ğŸ¦&lt;/span&gt; Andy&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;div class="space-y-3"&gt;&lt;div&gt;&lt;label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1.5 block"&gt;è¨˜å¸³åŒæ­¥è³‡æ–™åº« (GAS)&lt;/label&gt;&lt;input type="text" id="gasUrl" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 text-xs text-slate-600 outline-none" placeholder="https://script.google.com/..." readonly&gt;&lt;p class="text-[9px] text-slate-300 mt-1"&gt;* ç³»çµ±è‡ªå‹•å¸¶å…¥ï¼Œç„¡éœ€ä¿®æ”¹&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;div class="flex gap-2 mt-6"&gt;&lt;button onclick="document.getElementById('cloudModal').classList.add('hidden')" class="flex-1 py-3 rounded-xl bg-slate-100 text-slate-500 font-bold text-sm"&gt;é—œé–‰&lt;/button&gt;&lt;button onclick="syncWithCloud()" class="flex-1 py-3 rounded-xl bg-indigo-600 text-white font-bold shadow-md text-sm"&gt;ç«‹å³åŒæ­¥&lt;/button&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div id="smallPayDbModal" class="fixed inset-0 bg-slate-900/60 z-[70] hidden flex items-center justify-center p-4 backdrop-blur-sm"&gt;&lt;div class="bg-white rounded-3xl p-6 w-full max-w-xs shadow-2xl fade-in"&gt;&lt;h3 class="font-bold text-lg mb-1 text-slate-800 serif-font"&gt;åŒ¯å…¥å°é¡æ”¯ä»˜å®Œæ•´åå–®&lt;/h3&gt;&lt;p class="text-xs text-slate-400 mb-4"&gt;è²¼ä¸Š CSV ç¶²å€&lt;/p&gt;&lt;input type="text" id="smallPayCsvUrl" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 text-xs text-slate-600 outline-none mb-2" placeholder="https://docs.google.com/..."&gt;&lt;div class="flex gap-2"&gt;&lt;button onclick="document.getElementById('smallPayDbModal').classList.add('hidden')" class="flex-1 py-2 rounded-xl bg-slate-100 text-slate-500 font-bold text-sm"&gt;å–æ¶ˆ&lt;/button&gt;&lt;button onclick="saveSmallPayDb()" class="flex-1 py-2 rounded-xl bg-indigo-600 text-white font-bold shadow-md text-sm"&gt;åŒ¯å…¥&lt;/button&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div id="deleteConfirmModal" class="fixed inset-0 bg-slate-900/60 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-sm"&gt;&lt;div class="bg-white rounded-3xl p-6 w-full max-w-xs shadow-2xl fade-in transform transition-all scale-100"&gt;&lt;div class="flex flex-col items-center text-center mb-4"&gt;&lt;div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mb-3"&gt;&lt;i data-lucide="trash-2" class="w-6 h-6 text-red-500"&gt;&lt;/i&gt;&lt;/div&gt;&lt;h3 class="font-bold text-lg text-slate-800"&gt;ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ&lt;/h3&gt;&lt;p class="text-xs text-slate-500 mt-1"&gt;åˆªé™¤å¾Œå°‡ç„¡æ³•å¾©åŸã€‚&lt;/p&gt;&lt;/div&gt;&lt;div class="flex gap-3"&gt;&lt;button onclick="document.getElementById('deleteConfirmModal').classList.add('hidden')" class="flex-1 py-3 rounded-xl bg-slate-100 text-slate-600 font-bold text-sm"&gt;å–æ¶ˆ&lt;/button&gt;&lt;button onclick="executeDelete()" class="flex-1 py-3 rounded-xl bg-red-500 text-white font-bold shadow-md text-sm"&gt;ç¢ºèªåˆªé™¤&lt;/button&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;!-- Transaction Modal --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div id="transactionModal" class="fixed inset-0 bg-slate-900/60 z-50 hidden flex items-end sm:items-center justify-center backdrop-blur-sm transition-opacity"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="bg-white w-full sm:max-w-sm rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl animate-in slide-in-from-bottom-10 duration-300 max-h-[90vh] overflow-y-auto"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;div class="flex justify-between items-center mb-4"&gt;&lt;h3 class="text-xl font-bold text-slate-800 serif-font" id="txModalTitle"&gt;è¨˜ä¸€ç­†æ¶ˆè²»&lt;/h3&gt;&lt;button onclick="closeTransactionModal()" class="bg-slate-100 p-2 rounded-full text-slate-500 hover:bg-slate-200"&gt;&lt;i data-lucide="x" class="w-5 h-5"&gt;&lt;/i&gt;&lt;/button&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;div class="space-y-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div&gt;&lt;label class="text-xs font-bold text-slate-400 mb-1.5 block"&gt;é¸æ“‡å¡ç‰‡ &lt;span class="text-red-400"&gt;*&lt;/span&gt;&lt;/label&gt;&lt;select id="txCardSelect" class="w-full bg-slate-50 border-none rounded-xl p-3.5 text-slate-700 outline-none font-bold text-sm focus:ring-2 focus:ring-indigo-200"&gt;&lt;/select&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="flex gap-3"&gt;&lt;div class="flex-1"&gt;&lt;label class="text-xs font-bold text-slate-400 mb-1.5 block"&gt;é‡‘é¡ &lt;span class="text-red-400"&gt;*&lt;/span&gt;&lt;/label&gt;&lt;input type="number" id="txAmount" class="w-full bg-slate-50 border-none rounded-xl p-3.5 text-xl font-bold text-slate-800 outline-none focus:ring-2 focus:ring-indigo-200" placeholder="$0"&gt;&lt;/div&gt;&lt;div class="w-1/3"&gt;&lt;label class="text-xs font-bold text-slate-400 mb-1.5 block"&gt;æ—¥æœŸ &lt;span class="text-red-400"&gt;*&lt;/span&gt;&lt;/label&gt;&lt;input type="date" id="txDate" class="w-full bg-slate-50 border-none rounded-xl p-3.5 text-xs font-bold text-slate-600 outline-none focus:ring-2 focus:ring-indigo-200"&gt;&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div&gt;&lt;label class="text-xs font-bold text-slate-400 mb-1.5 block"&gt;æ¶ˆè²»é¡åˆ¥ &lt;span class="text-red-400"&gt;*&lt;/span&gt;&lt;/label&gt;&lt;div class="relative"&gt;&lt;select id="txCategory" class="w-full bg-slate-50 border-none rounded-xl p-3.5 text-sm font-bold text-slate-700 outline-none focus:ring-2 focus:ring-indigo-200"&gt;&lt;/select&gt;&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div&gt;&lt;label class="text-xs font-bold text-slate-400 mb-1.5 block"&gt;æ¶ˆè²»ç´°é … &lt;span class="text-indigo-400 text-[10px]"&gt;(é¸å¡«)&lt;/span&gt;&lt;/label&gt;&lt;input type="text" id="txItem" class="w-full bg-slate-50 border-none rounded-xl p-3.5 text-sm text-slate-700 outline-none focus:ring-2 focus:ring-indigo-200" placeholder="ä¾‹å¦‚ï¼šéº¥ç•¶å‹ã€å…¨è¯..."&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div&gt;&lt;label class="text-xs font-bold text-slate-400 mb-1.5 block"&gt;æ¶ˆè²»é¡å‹&lt;/label&gt;&lt;div class="flex gap-3"&gt;&lt;label class="flex-1 cursor-pointer custom-checkbox"&gt;&lt;input type="checkbox" id="checkReward" value="reward" class="hidden" checked&gt;&lt;div class="border border-slate-200 rounded-xl py-3 text-center text-xs font-bold text-slate-500 transition-colors select-none"&gt;æŒ‡å®šå›é¥‹&lt;/div&gt;&lt;/label&gt;&lt;label class="flex-1 cursor-pointer custom-checkbox"&gt;&lt;input type="checkbox" id="checkGeneral" value="general" class="hidden"&gt;&lt;div class="border border-slate-200 rounded-xl py-3 text-center text-xs font-bold text-slate-500 transition-colors select-none"&gt;ä¸€èˆ¬/ä½æ¶ˆ&lt;/div&gt;&lt;/label&gt;&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div&gt;&lt;input type="text" id="txNote" class="w-full bg-transparent border-b border-slate-200 p-2 text-sm text-slate-600 outline-none placeholder-slate-300" placeholder="å‚™è¨» (é¸å¡«)..."&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;!-- V75 Fix: Added explicit style to delete button wrapper to ensure visibility --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="flex gap-3 mt-4 pt-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button id="btnDeleteTx" class="hidden flex-1 py-3.5 rounded-xl border border-red-200 text-red-500 font-bold bg-red-50 hover:bg-red-100 transition-colors" onclick="openDeleteConfirm()"&gt;åˆªé™¤&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;button onclick="saveTransaction()" class="flex-[2] bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-bold py-3.5 rounded-xl shadow-lg hover:shadow-indigo-200/50 transition-all active:scale-[0.98]"&gt;å„²å­˜&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;!-- History &amp; Settings Modals --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div id="historyModal" class="fixed inset-0 bg-slate-50 z-50 hidden flex flex-col"&gt;&lt;div class="bg-white border-b border-slate-100 p-4 pt-safe-top flex justify-between items-center shadow-sm z-10 sticky top-0"&gt;&lt;div class="flex items-center gap-2"&gt;&lt;button onclick="closeHistoryModal()" class="p-2 -ml-2 text-slate-400 hover:text-indigo-600"&gt;&lt;i data-lucide="arrow-left" class="w-6 h-6"&gt;&lt;/i&gt;&lt;/button&gt;&lt;h2 class="text-lg font-bold text-slate-800 serif-font"&gt;æ­·å²å¸³æœ¬&lt;/h2&gt;&lt;/div&gt;&lt;div class="text-sm font-bold text-indigo-600 bg-indigo-50 px-3 py-1 rounded-full" id="historyTotalDisplay"&gt;$0&lt;/div&gt;&lt;/div&gt;&lt;div class="flex-1 overflow-y-auto p-4 space-y-3" id="historyListContainer"&gt;&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div id="settingsModal" class="fixed inset-0 bg-slate-900/60 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm"&gt;&lt;div class="bg-white rounded-3xl p-6 w-full max-w-xs shadow-2xl fade-in"&gt;&lt;h3 class="font-bold text-lg mb-1 text-slate-800 serif-font"&gt;å¡ç‰‡è¨­å®š&lt;/h3&gt;&lt;h4 class="text-sm text-indigo-500 font-bold mb-4 text-center" id="settingsCardName"&gt;&lt;/h4&gt;&lt;div class="space-y-4 mt-2"&gt;&lt;div&gt;&lt;label class="text-[10px] font-bold text-indigo-400 uppercase tracking-widest mb-1.5 block"&gt;æœ€ä½³å›é¥‹ä¸Šé™&lt;/label&gt;&lt;div class="input-box-fixed"&gt;&lt;span class="text-indigo-400 font-bold mr-2"&gt;$&lt;/span&gt;&lt;input type="number" id="settingCap" class="flex-1 bg-transparent outline-none text-slate-700 font-bold text-lg h-6" placeholder="ç„¡ä¸Šé™"&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;label class="text-[10px] font-bold text-orange-400 uppercase tracking-widest mb-1.5 block"&gt;ä½æ¶ˆé–€æª»&lt;/label&gt;&lt;div class="input-box-fixed"&gt;&lt;span class="text-orange-400 font-bold mr-2"&gt;$&lt;/span&gt;&lt;input type="number" id="settingMin" class="flex-1 bg-transparent outline-none text-slate-700 font-bold text-lg h-6" placeholder="0"&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="bg-slate-50 p-4 rounded-2xl border border-slate-100"&gt;&lt;label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 block"&gt;è¨ˆç®—é€±æœŸ&lt;/label&gt;&lt;div class="flex gap-2 mb-3"&gt;&lt;button type="button" onclick="setCycleMode('month')" id="btnCycleMonth" class="flex-1 py-2 text-xs font-bold rounded-lg border"&gt;æ—¥æ›†æœˆ&lt;/button&gt;&lt;button type="button" onclick="setCycleMode('bill')" id="btnCycleBill" class="flex-1 py-2 text-xs font-bold rounded-lg border"&gt;çµå¸³æ—¥&lt;/button&gt;&lt;/div&gt;&lt;div id="billDateInputGroup" class="hidden flex items-center gap-2 justify-center"&gt;&lt;span class="text-xs text-slate-500 font-bold"&gt;æ¯æœˆ&lt;/span&gt;&lt;input type="number" id="settingBillDay" min="1" max="31" class="w-14 text-center bg-white rounded-lg border border-slate-200 outline-none text-sm font-bold text-indigo-600 py-1.5" value="1"&gt;&lt;span class="text-xs text-slate-500 font-bold"&gt;æ—¥ çµå¸³&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="flex gap-3 mt-6"&gt;&lt;button onclick="closeSettingsModal()" class="flex-1 py-3 rounded-xl bg-slate-100 text-slate-500 font-bold text-sm"&gt;å–æ¶ˆ&lt;/button&gt;&lt;button onclick="saveCardSettings()" class="flex-1 py-3 rounded-xl bg-indigo-600 text-white font-bold shadow-md text-sm"&gt;ç¢ºèª&lt;/button&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// --- CONSTANTS ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const DEFAULT_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQhVkQJhNqPQAxXv-q0ethYeViFm69TyPnqRTmejQdwqgKtOvOLRbZ7toKBBTq7rWiqkQFMtGxvvWpC/pub?output=csv";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const DEFAULT_SMALL_PAY_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSP7uOSfbfEnZx_TsDltCox5ubDR3f5ofOK7g-WEAp-y38coNSnY_VHfY1WuI8tqA/pub?output=csv";</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const USER_CONFIGS = {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>'Lynn': 'https://script.google.com/macros/s/AKfycbx4fis6JsM0YYp1KUzRb0xAPnhJPqIgR-MVtc8AGWjLjbFCXHWT5xW2JqAsGiw_B0d1IQ/exec',</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>'Andy': 'https://script.google.com/macros/s/AKfycbzBHPtqIfPWxbAmF6B7yQYT8jd4btfJycPiihUhqpLZwMXNRTM5PUsgURumPvpsVMNXHA/exec'</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const TX_CATEGORIES = ["ğŸ½ï¸ é¤é£²", "ğŸ¥¦ é£Ÿæ", "ğŸ›ï¸ è³¼ç‰©", "ğŸ¬ å¨›æ¨‚", "ğŸ’Š é†«ç™‚", "ğŸšŒ äº¤é€š", "â›½ åŠ æ²¹", "ğŸ¾ å¯µç‰©", "âœˆï¸ æ—…éŠ", "ğŸ›¡ï¸ ä¿éšª", "ğŸ“š èª²ç¨‹", "ğŸ’° ç¹³è²»", "ğŸ“¦ å…¶ä»–"];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const TAIWAN_CITIES = ["å°åŒ—å¸‚", "æ–°åŒ—å¸‚", "åŸºéš†å¸‚", "æ¡ƒåœ’å¸‚", "æ–°ç«¹å¸‚", "æ–°ç«¹ç¸£", "è‹—æ —ç¸£", "å°ä¸­å¸‚", "å½°åŒ–ç¸£", "å—æŠ•ç¸£", "é›²æ—ç¸£", "å˜‰ç¾©å¸‚", "å˜‰ç¾©ç¸£", "å°å—å¸‚", "é«˜é›„å¸‚", "å±æ±ç¸£", "å®œè˜­ç¸£", "èŠ±è“®ç¸£", "å°æ±ç¸£"];</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let SMALL_PAYMENT_CHAINS = ["éº¥ç•¶å‹", "è‚¯å¾·åŸº", "æ¼¢å ¡ç‹", "æ‘©æ–¯", "7-11", "å…¨å®¶", "èŠçˆ¾å¯Œ", "OK", "50åµ", "æ¸…å¿ƒ", "CoCo", "å…¨è¯", "ç¾å»‰ç¤¾", "å…«æ–¹é›²é›†", "çˆ­é®®", "é›»è©±äº­KTV"];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let SMALL_PAYMENT_STORES_DB = [];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let allCardsData = [], uniqueBanks = [];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let transactions = [];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let cardSettings = {};</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let currentUser = localStorage.getItem('cc_current_user') || null;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let API_URL = "";</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let currentView = 'manage';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let showActiveOnly = false;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let editingTransactionId = null;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let currentBankFilter = '', currentCardFilter = '', manageCardFilter = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let editingCardId = null;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let tempPin = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let pendingUser = '';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const getStorageKey = (key) =&gt; currentUser ? `cc_${key}_${currentUser}` : null;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>function init() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>loadSmallPayCsv(DEFAULT_SMALL_PAY_CSV_URL);</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>Papa.parse(DEFAULT_CSV_URL, {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>download: true, header: true, skipEmptyLines: true,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>complete: (results) =&gt; { allCardsData = processRawData(results.data); initDropdowns(); renderView(); },</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>error: () =&gt; { allCardsData = []; initDropdowns(); renderView(); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>document.getElementById('txDate').valueAsDate = new Date();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>initCategoryDropdown();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>initCityDropdown();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// LOGIN CHECK</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const app = document.getElementById('appContainer');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const login = document.getElementById('loginScreen');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>app.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>login.classList.remove('hidden');</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// Wait for login</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// --- LOGIN LOGIC ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.promptPin = function(user) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>pendingUser = user;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>tempPin = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>document.getElementById('userSelectArea').classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>document.getElementById('pinArea').classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>document.getElementById('pinUserName').innerText = user;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>document.getElementById('pinUserIcon').innerText = user === 'Lynn' ? 'ğŸ±' : 'ğŸ¦';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>updatePinDots();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.resetPinUI = function() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>tempPin = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>document.getElementById('pinArea').classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>document.getElementById('userSelectArea').classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.addPin = function(num) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(tempPin.length &lt; 4) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>tempPin += num;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>updatePinDots();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if(tempPin.length === 4) checkPin();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.deletePin = function() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>tempPin = tempPin.slice(0, -1);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>updatePinDots();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.updatePinDots = function() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const dots = document.querySelectorAll('.pin-dot');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>dots.forEach((dot, index) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if(index &lt; tempPin.length) dot.classList.add('active');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>else dot.classList.remove('active');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.checkPin = function() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(tempPin === '0515') {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>loginSuccess(pendingUser);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const pinArea = document.getElementById('pinArea');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>pinArea.classList.add('animate-shake');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>setTimeout(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>pinArea.classList.remove('animate-shake');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>tempPin = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>updatePinDots();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}, 500);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.loginSuccess = function(user) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>currentUser = user;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>localStorage.setItem('cc_current_user', user);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>API_URL = USER_CONFIGS[user];</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>document.getElementById('loginScreen').classList.add('opacity-0', 'pointer-events-none');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>setTimeout(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('loginScreen').classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('appContainer').classList.remove('hidden');</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>// FORCE UI UPDATE: Ensure tab is active and FAB is visible</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>switchTab('manage');<span class="Apple-converted-space">Â </span></p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>setTimeout(() =&gt; document.getElementById('appContainer').classList.remove('opacity-0'), 50);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}, 500);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>updateUserUI();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>loadUserData();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.logout = function() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>document.getElementById('cloudModal').classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>document.getElementById('appContainer').classList.add('opacity-0');</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>setTimeout(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('appContainer').classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('loginScreen').classList.remove('hidden', 'opacity-0', 'pointer-events-none');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>resetPinUI();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}, 500);</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>currentUser = null;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>transactions = [];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>function loadUserData() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (!currentUser) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>cardSettings = JSON.parse(localStorage.getItem(getStorageKey('card_settings')) || '{}');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>transactions = JSON.parse(localStorage.getItem(getStorageKey('transactions')) || '[]');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>document.getElementById('gasUrl').value = API_URL;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>syncWithCloud();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>function updateUserUI() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const badge = document.getElementById('userBadge');</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (currentUser === 'Lynn') {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>badge.innerText = "ğŸ± Lynn";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>badge.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>} else if (currentUser === 'Andy') {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>badge.innerText = "ğŸ¦ Andy";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>badge.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// --- CORE FUNCTIONS (Standard) ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.initCategoryDropdown = function() { const s = document.getElementById('txCategory'); s.innerHTML=''; TX_CATEGORIES.forEach(c =&gt; { const o = document.createElement('option'); o.value=c; o.text=c; s.appendChild(o); }); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.initCityDropdown = function() { const s = document.getElementById('smallPayCitySelect'); s.innerHTML='&lt;option value=""&gt;ğŸ™ï¸ ä¾ç¸£å¸‚æŸ¥è©¢åº—å®¶&lt;/option&gt;'; TAIWAN_CITIES.forEach(c =&gt; { const o = document.createElement('option'); o.value=c; o.text=c; s.appendChild(o); }); }</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.processRawData = function(data) {<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const map = new Map(); uniqueBanks = [];<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>data.forEach(row =&gt; {<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const get = (k) =&gt; { const f = Object.keys(row).find(x =&gt; k.some(y =&gt; y.toLowerCase() === x.trim().toLowerCase())); return f ? row[f] : ""; };</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const bank = get(['éŠ€è¡Œ','bank']); const name = get(['å¡å','name']);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if(!bank || !name) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const id = `${bank}-${name}`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if(!uniqueBanks.includes(bank)) uniqueBanks.push(bank);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if(!map.has(id)) map.set(id, {<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>id, bank, name,<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>color: getBankColor(bank),<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>offers: [],<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>defaultMin: 0,<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>defaultCap: 0,<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>domesticBase: '',<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>foreignBase: '',</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>lynnBillDay: 0,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>andyBillDay: 0,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>expiryDate: ''<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const obj = map.get(id);</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>// 1. Taichung Bank Low Spend (V70 Logic: G69 is Min Spend again as requested)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (bank === 'å°ä¸­éŠ€') {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const g69 = get(['G69']);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (g69) {</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const n = parseFloat(String(g69).replace(/[^\d.]/g, ''));</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (!isNaN(n) &amp;&amp; n &gt; 0) obj.defaultMin = n;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const min = get(['ä½æ¶ˆ', 'é–€æª»', 'min', 'low', 'å›é¥‹ä½æ¶ˆ']);</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if(min) { const n = parseFloat(String(min).replace(/[^\d.]/g, '')); if(!isNaN(n) &amp;&amp; n &gt; 0) obj.defaultMin = n; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const min = get(['ä½æ¶ˆ', 'é–€æª»', 'min', 'low', 'å›é¥‹ä½æ¶ˆ']);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if(min) { const n = parseFloat(String(min).replace(/[^\d.]/g, '')); if(!isNaN(n) &amp;&amp; n &gt; 0) obj.defaultMin = n; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>// 2. Cap Logic (V70 Fix: Max of 'æŒ‡å®šå›é¥‹ä¸Šé™' within same card group)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const capRow = get(['æŒ‡å®šå›é¥‹ä¸Šé™', 'bonus_cap', 'æœ€ä½³åˆ·å¡ä¸Šé™', 'åˆ·å¡ä¸Šé™', 'cap', 'limit', 'ä¸Šé™']);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if(capRow) {<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const n = parseFloat(String(capRow).replace(/[^\d.]/g, ''));<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if(!isNaN(n) &amp;&amp; n &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>// Take the max value found across all rows for this card</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>obj.defaultCap = Math.max(obj.defaultCap, n);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const domBase = get(['åœ‹å…§åŸºç¤å›é¥‹', 'åœ‹å…§åŸºç¤', 'domestic']);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if(domBase) obj.domesticBase = domBase;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const forBase = get(['åœ‹å¤–åŸºç¤å›é¥‹', 'åœ‹å¤–åŸºç¤', 'foreign']);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if(forBase) obj.foreignBase = forBase;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const baseCap = get(['åŸºç¤å›é¥‹ä¸Šé™', 'base_cap']);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (baseCap) obj.baseCap = baseCap;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>// 2. Bill Days</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const lynnDay = get(['Lynnçµå¸³æ—¥', 'lynn_bill']);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (lynnDay) { const n = parseInt(String(lynnDay).replace(/[^\d]/g, '')); if(!isNaN(n)) obj.lynnBillDay = n; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const andyDay = get(['Andyçµå¸³æ—¥', 'andy_bill']);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (andyDay) { const n = parseInt(String(andyDay).replace(/[^\d]/g, '')); if(!isNaN(n)) obj.andyBillDay = n; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>// 5. Expiry Date</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const expiry = get(['æ¬Šç›ŠæœŸé™', 'expiry', 'valid_until']);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (expiry) obj.expiryDate = expiry;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const cat = get(['é¡åˆ¥', 'category']);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if(cat) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>let rawRate = String(get(['æœ€ä½³å›é¥‹', 'åŸºç¤+æŒ‡å®šå›é¥‹', 'æœ€é«˜å›é¥‹', 'max_total', 'å›é¥‹', 'rate']) || '0');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if(rawRate === '0') rawRate = String(get(['å›é¥‹', 'rate']) || '0');<span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>let rateVal = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (rawRate.includes('-') || rawRate.includes('~')) {</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const parts = rawRate.split(/[-~]/).map(p =&gt; parseFloat(p.replace('%',''))).filter(n =&gt; !isNaN(n));</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>rateVal = Math.max(...parts);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>rateVal = parseFloat(rawRate.replace('%','')) || 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if(!rawRate.includes('%') &amp;&amp; rateVal &gt; 0) rawRate += '%';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>obj.offers.push({<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>category: cat,<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>rate: rateVal,<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>rateStr: rawRate,<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>desc: get(['èªªæ˜', 'å‚™è¨»', 'desc', 'note']),<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>tags: String(get(['é—œéµå­—', 'tags'])).split(/[,ï¼Œã€]/).filter(Boolean),<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>baseRate: get(['åŸºç¤', 'baseRate']),<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>cap: get(['ä¸Šé™', 'cap']),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>paymentMethod: get(['é™å®šæ”¯ä»˜æ–¹å¼', 'é™å®šæ”¯ä»˜', 'payment']),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>bonusRate: get(['æŒ‡å®šåŠ ç¢¼å›é¥‹', 'bonus_rate']),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>bonusCap: get(['æŒ‡å®šå›é¥‹ä¸Šé™', 'bonus_cap']),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>totalRate: get(['åŸºç¤+æŒ‡å®šå›é¥‹', 'åŸºç¤åŠ æŒ‡å®š', 'max_total'])</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>return Array.from(map.values());</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.getBankColor = function(b) { if(b.includes("å°æ–°")) return "bg-gradient-to-r from-red-400 to-red-500"; if(b.includes("ç‰å±±")) return "bg-gradient-to-r from-emerald-400 to-emerald-500"; if(b.includes("å¯Œé‚¦")) return "bg-gradient-to-r from-cyan-500 to-blue-500"; if(b.includes("åœ‹æ³°") || b.includes("CUBE")) return "bg-gradient-to-r from-lime-500 to-green-500"; return "bg-gradient-to-r from-gray-400 to-gray-500"; }</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.initDropdowns = function() {<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const b = document.getElementById('bankSelect'); b.innerHTML='&lt;option value=""&gt;æ‰€æœ‰éŠ€è¡Œ&lt;/option&gt;'; uniqueBanks.forEach(x =&gt; { const o = document.createElement('option'); o.value=x; o.text=x; b.appendChild(o); });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const m = document.getElementById('manageCardFilter'); m.innerHTML='&lt;option value=""&gt;ğŸ’³ æ‰€æœ‰ä¿¡ç”¨å¡&lt;/option&gt;'; allCardsData.forEach(c =&gt; { const o = document.createElement('option'); o.value=c.id; o.text=c.name; m.appendChild(o); });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.getCardDefaultCap = function(id) { const c = allCardsData.find(x =&gt; x.id === id); if(c &amp;&amp; c.offers.length &gt; 0) for(let o of c.offers) { if(o.cap &amp;&amp; !o.cap.includes("ç„¡")) { const n = parseFloat(o.cap.replace(/[^\d.]/g, '')); if(!isNaN(n) &amp;&amp; n &gt; 0) return n; } } return 0; }</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.saveCloudSettings = async function() { document.getElementById('cloudModal').classList.add('hidden'); syncWithCloud(); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.syncWithCloud = async function() {<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(!API_URL) return;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>showLoading(true, "é›²ç«¯åŒæ­¥ä¸­...");<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>try {<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const r = await fetch(API_URL + '?action=read');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const j = await r.json();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if(j.status === 'success' &amp;&amp; j.data) {<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>transactions = j.data;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>localStorage.setItem(getStorageKey('transactions'), JSON.stringify(transactions));<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>renderView();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>showToast('åŒæ­¥å®Œæˆ');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>} catch(e) { showToast('åŒæ­¥å¤±æ•—'); } finally { showLoading(false); }<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.postToCloud = async function(tx, action='save') {<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(!API_URL) return;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>try { await fetch(API_URL + `?action=${action}${action==='delete'?'&amp;id='+tx.id:''}`, { method: 'POST', body: JSON.stringify(tx) }); } catch(e) {}<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.showLoading = function(show, text = "é›²ç«¯åŒæ­¥ä¸­...") { document.getElementById('loadingText').innerText=text; document.getElementById('loadingOverlay').classList.toggle('hidden', !show); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.showToast = function(msg) { const t = document.getElementById('toast'); t.innerText = msg; t.classList.remove('opacity-0', 'pointer-events-none'); setTimeout(() =&gt; t.classList.add('opacity-0', 'pointer-events-none'), 2000); }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.switchTab = function(view) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>currentView = view;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>document.querySelectorAll('.tab-btn').forEach(b =&gt; b.classList.remove('active'));</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const ids = ['headerControls', 'manageControls', 'smallPayControls', 'totalSpendDisplay', 'fabContainer'];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>ids.forEach(id =&gt; document.getElementById(id).classList.add('hidden'));</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const aiBot = document.getElementById('btnAiBot');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const fabContainer = document.getElementById('fabContainer');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(view === 'search') {<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('btnSearch').classList.add('active');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('headerControls').classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>aiBot.classList.remove('hidden'); setTimeout(()=&gt; aiBot.classList.add('show'), 50);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>aiBot.classList.remove('show'); setTimeout(()=&gt; aiBot.classList.add('hidden'), 300);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (view === 'manage') {<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('btnManage').classList.add('active');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('manageControls').classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('totalSpendDisplay').classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>fabContainer.classList.remove('hidden'); fabContainer.style.display='block';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>} else if (view === 'smallpay') {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('btnSmallPay').classList.add('active');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('smallPayControls').classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>fabContainer.classList.add('hidden'); fabContainer.style.display='none';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>renderView();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.renderView = function() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const container = document.getElementById('mainContent');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>container.innerHTML = "";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (currentView === 'search') renderSearchView(container);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>else if (currentView === 'manage') renderManageView(container);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>lucide.createIcons();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>checkScroll();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// --- SEARCH VIEW ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.renderSearchView = function(container) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const searchText = document.getElementById('searchInput').value.toLowerCase().trim();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const filtered = allCardsData.filter(c =&gt; (!currentBankFilter || c.bank === currentBankFilter) &amp;&amp; (!currentCardFilter || c.name === currentCardFilter)).map(card =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const matches = card.offers.filter(offer =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (offer.rate &lt;= 0) return false;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (!searchText) return true;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>return offer.desc.toLowerCase().includes(searchText) || offer.category.toLowerCase().includes(searchText) || card.name.toLowerCase().includes(searchText) || offer.tags.some(t =&gt; t.toLowerCase().includes(searchText));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>matches.sort((a,b) =&gt; b.rate - a.rate);</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const maxRate = matches.length &gt; 0 ? matches[0].rate : 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>return { ...card, matches, maxRate, hasMatch: matches.length &gt; 0 };</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}).filter(c =&gt; c.hasMatch).sort((a,b) =&gt; b.maxRate - a.maxRate);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(filtered.length === 0) { document.getElementById('noResult').classList.remove('hidden'); return; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>else document.getElementById('noResult').classList.add('hidden');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>filtered.forEach(card =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const el = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>el.className = "glass-card rounded-3xl p-5 mb-4 fade-in relative";</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>let baseRewardHtml = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>let bases = [];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if(card.domesticBase) bases.push(`ğŸ‡¹ğŸ‡¼ å°ç£ ${card.domesticBase}`);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if(card.foreignBase) bases.push(`âœˆï¸ åœ‹å¤– ${card.foreignBase}`);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if(card.baseCap) bases.push(`ğŸ›‘ åŸºç¤ä¸Šé™: ${card.baseCap}`);</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if(bases.length &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>baseRewardHtml = `&lt;div class="flex flex-wrap gap-2 mb-3 text-[10px] text-slate-500 font-bold bg-slate-50/50 p-2 rounded-xl border border-slate-100/50"&gt;` +<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>bases.map(b =&gt; `&lt;span&gt;${b}&lt;/span&gt;`).join('&lt;span class="opacity-30"&gt;|&lt;/span&gt;') +<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>`&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>el.innerHTML = `&lt;div class="flex gap-3 items-center mb-2 pb-2 border-b border-gray-100/50"&gt;&lt;span class="bank-badge ${card.color}"&gt;${card.bank}&lt;/span&gt;&lt;h3 class="font-bold text-slate-700 serif-font text-lg"&gt;${card.name}&lt;/h3&gt;&lt;/div&gt;${baseRewardHtml}`;</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>card.matches.forEach(offer =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>let displayTags = offer.tags;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (searchText) { const matchingTags = offer.tags.filter(t =&gt; t.toLowerCase().includes(searchText)); if (matchingTags.length &gt; 0) displayTags = matchingTags; }</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const TAG_LIMIT = 5;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const hasMore = displayTags.length &gt; TAG_LIMIT;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const shownTags = displayTags.slice(0, TAG_LIMIT);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const hiddenTags = displayTags.slice(TAG_LIMIT);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const tagClassId = `extra-tag-${card.id}-${offer.category.replace(/\s/g,'')}`;</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>let tagsHtml = shownTags.map(tag =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const isHit = searchText &amp;&amp; tag.toLowerCase().includes(searchText);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const style = isHit ? 'bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-md' : 'bg-slate-200/70 text-slate-700';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>return `&lt;span class="text-[10px] px-2.5 py-1 rounded-full font-medium ${style} transition-colors"&gt;${tag}&lt;/span&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}).join('');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if(hasMore) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const hiddenHtml = hiddenTags.map(tag =&gt; `&lt;span class="text-[10px] px-2.5 py-1 rounded-full font-medium bg-slate-200/70 text-slate-700 hidden ${tagClassId}"&gt;${tag}&lt;/span&gt;`).join('');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>tagsHtml += hiddenHtml;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>tagsHtml += `&lt;button onclick="toggleTags(this, '${tagClassId}', ${hiddenTags.length})" class="text-[10px] px-2.5 py-1 rounded-full font-bold bg-indigo-100 text-indigo-500 hover:bg-indigo-200 transition-colors"&gt;+${hiddenTags.length}&lt;/button&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>let infoBadges = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if(offer.paymentMethod) infoBadges += `&lt;span class="text-[9px] bg-blue-50 text-blue-500 border border-blue-100 px-1.5 py-0.5 rounded-2xl font-bold ml-1"&gt;é™ ${offer.paymentMethod}&lt;/span&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if(offer.totalRate) infoBadges += `&lt;span class="text-[9px] bg-pink-50 text-pink-500 border border-pink-100 px-1.5 py-0.5 rounded-2xl font-bold ml-1"&gt;ğŸ”¥ æœ€é«˜ ${offer.totalRate}&lt;/span&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if(card.defaultMin &gt; 0) infoBadges += `&lt;span class="text-[9px] bg-orange-50 text-orange-500 border border-orange-100 px-1.5 py-0.5 rounded-2xl font-bold ml-1"&gt;ğŸ’° ä½æ¶ˆ: $${card.defaultMin.toLocaleString()}&lt;/span&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if(offer.bonusCap) infoBadges += `&lt;span class="text-[9px] bg-pink-50 text-pink-500 border border-pink-100 px-1.5 py-0.5 rounded-2xl font-bold ml-1"&gt;ğŸ›‘ ä¸Šé™: ${offer.bonusCap}&lt;/span&gt;`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>let extraDetails = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if(offer.bonusRate) extraDetails += `&lt;span class="text-[10px] text-indigo-400 font-bold mr-2"&gt;ğŸ åŠ ç¢¼: ${offer.bonusRate}&lt;/span&gt;`;</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if(extraDetails) extraDetails = `&lt;div class="mb-1.5 flex flex-wrap"&gt;${extraDetails}&lt;/div&gt;`;</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>el.innerHTML += `&lt;div class="mb-4 last:mb-0 p-3 bg-white/40 rounded-2xl border border-white/50 shadow-sm"&gt;&lt;div class="flex justify-between items-center mb-1"&gt;&lt;h4 class="font-bold text-slate-700 text-sm flex items-center gap-1.5 flex-wrap"&gt;â˜… ${offer.category} ${infoBadges}&lt;/h4&gt;&lt;span class="text-xl font-bold text-indigo-500 serif-font"&gt;${offer.rateStr}&lt;/span&gt;&lt;/div&gt;${extraDetails}&lt;p class="text-xs text-slate-500 mb-2 leading-relaxed"&gt;${offer.desc}&lt;/p&gt;&lt;div class="flex flex-wrap gap-1.5"&gt;${tagsHtml}&lt;/div&gt;&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>// 5. Expiry Date Footer</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (card.expiryDate) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>el.innerHTML += `&lt;div class="mt-2 pt-2 border-t border-slate-100 text-[10px] text-right text-slate-400 font-medium"&gt;ğŸ“… æœŸé™: ${card.expiryDate}&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>container.appendChild(el);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.toggleTags = function(btn, classId, count) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const els = document.querySelectorAll('.' + classId);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const isHidden = els[0].classList.contains('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>els.forEach(el =&gt; el.classList.toggle('hidden'));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(isHidden) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>btn.innerText = "æ”¶èµ·";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>btn.classList.add('bg-slate-200', 'text-slate-500');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>btn.classList.remove('bg-indigo-100', 'text-indigo-500');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>btn.innerText = "+" + count;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>btn.classList.remove('bg-slate-200', 'text-slate-500');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>btn.classList.add('bg-indigo-100', 'text-indigo-500');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// --- MANAGE VIEW ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.renderManageView = function(container) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(!currentUser) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>container.innerHTML = `&lt;div class="text-center py-20 opacity-60"&gt;&lt;div class="bg-white/50 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 shadow-sm backdrop-blur-sm"&gt;&lt;i data-lucide="user-circle" class="w-10 h-10 text-indigo-200"&gt;&lt;/i&gt;&lt;/div&gt;&lt;p class="text-indigo-400 font-bold text-sm tracking-widest mb-4"&gt;è«‹å…ˆé¸æ“‡æ‚¨çš„èº«åˆ†&lt;/p&gt;&lt;button onclick="document.getElementById('cloudModal').classList.remove('hidden')" class="bg-indigo-500 text-white px-6 py-3 rounded-xl font-bold shadow-lg"&gt;å‰å¾€è¨­å®š&lt;/button&gt;&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('totalSpendDisplay').innerText = `æœ¬æœŸ $0`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('fabContainer').style.display = 'none';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const today = new Date();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>let totalMonthlySpend = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>let cardsToRender = allCardsData;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (manageCardFilter) cardsToRender = allCardsData.filter(c =&gt; c.id === manageCardFilter);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>let cardsWithStats = cardsToRender.map(card =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>// 2. AUTO-POPULATE BILL DAY FROM CSV LOGIC (V75 FIX)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>let csvBillDay = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if(currentUser === 'Lynn' &amp;&amp; card.lynnBillDay &gt; 0) csvBillDay = card.lynnBillDay;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>else if(currentUser === 'Andy' &amp;&amp; card.andyBillDay &gt; 0) csvBillDay = card.andyBillDay;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>// Load saved settings or create default</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const savedSettings = cardSettings[card.id];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>let settings = savedSettings ? { ...savedSettings } : { cycleType: 'month', billDay: 1, customCap: 0, customMin: 0 };</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>// FORCE UPDATE logic: If CSV implies a bill day, default to 'bill' mode</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>// unless user specifically set it to 'month' in the past (which we assume if savedSettings exists and cycleType is month)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>// However, to satisfy "è‡ªå‹•å¯«å…¥", if savedSettings is missing OR if we want to sync, we check:</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (csvBillDay &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (!savedSettings || (savedSettings &amp;&amp; savedSettings.cycleType === 'bill')) {</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>settings.cycleType = 'bill';</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>settings.billDay = csvBillDay;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const cycle = getCycleRange(settings, today);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const cycleTxs = transactions.filter(t =&gt; t.cardId === card.id &amp;&amp; t.date &gt;= cycle.start &amp;&amp; t.date &lt;= cycle.end);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const rewardSpent = cycleTxs.filter(t =&gt; t.types.includes('reward')).reduce((sum, t) =&gt; sum + parseFloat(t.amount), 0);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const generalSpent = cycleTxs.filter(t =&gt; t.types.includes('general')).reduce((sum, t) =&gt; sum + parseFloat(t.amount), 0);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const distinctTotal = cycleTxs.reduce((sum, t) =&gt; sum + parseFloat(t.amount), 0);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>totalMonthlySpend += distinctTotal;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>return { ...card, rewardSpent, generalSpent, distinctTotal, settings, cycleTxs };</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (showActiveOnly) cardsWithStats = cardsWithStats.filter(c =&gt; c.distinctTotal &gt; 0);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>document.getElementById('totalSpendDisplay').innerText = `æœ¬æœŸ $${totalMonthlySpend.toLocaleString()}`;</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>cardsWithStats.sort((a, b) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const aActive = a.distinctTotal &gt; 0 ? 1 : 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const bActive = b.distinctTotal &gt; 0 ? 1 : 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (aActive !== bActive) return bActive - aActive;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>return b.distinctTotal - a.distinctTotal || a.name.localeCompare(b.name);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(cardsWithStats.length === 0) document.getElementById('noResult').classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>else document.getElementById('noResult').classList.add('hidden');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>cardsWithStats.forEach(card =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const cap = parseFloat(card.settings.customCap) || card.defaultCap || getCardDefaultCap(card.id) || 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const min = parseFloat(card.settings.customMin) || card.defaultMin || 0;</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const capPercent = cap &gt; 0 ? Math.min((card.rewardSpent / cap) * 100, 100) : 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const remaining = cap &gt; 0 ? (cap - card.rewardSpent) : null;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const minPercent = min &gt; 0 ? Math.min((card.generalSpent / min) * 100, 100) : 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const minRemaining = min &gt; 0 ? (min - card.generalSpent) : null;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>let barColor = capPercent &gt; 90 ? 'bg-red-400' : 'bg-indigo-500';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const el = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>el.className = "glass-card rounded-3xl p-5 mb-5 fade-in relative";</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>let txListHtml = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if(card.cycleTxs.length &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>txListHtml = `&lt;div class="mt-3 pt-2 border-t border-slate-100 space-y-2"&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>card.cycleTxs.sort((a,b) =&gt; new Date(b.date) - new Date(a.date)).forEach(tx =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>let badges = tx.types.includes('general') ? '&lt;span class="w-1.5 h-1.5 rounded-full bg-orange-400"&gt;&lt;/span&gt;' : '&lt;span class="w-1.5 h-1.5 rounded-full bg-indigo-400"&gt;&lt;/span&gt;';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const displayTitle = (tx.category ? tx.category.split(' ')[1] : '') + ' ' + (tx.item || tx.note || 'æ¶ˆè²»');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>txListHtml += `</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="flex justify-between items-center text-xs tx-row p-2 rounded-lg hover:bg-slate-50 transition-colors" onclick="window.openTransactionModal('${tx.id}')"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="flex items-center gap-2 text-slate-500"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>${badges}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;span class="font-mono text-slate-400"&gt;${tx.date.slice(5)}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;span class="font-medium text-slate-700 truncate max-w-[120px]"&gt;${displayTitle}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;span class="font-bold text-slate-700"&gt;$${parseFloat(tx.amount).toLocaleString()}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>txListHtml += `&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>// 4. Fixed Settings Button</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const setBtn = `&lt;button onclick="window.openSettingsModal('${card.id}', '${card.name}')" class="absolute top-4 right-4 text-slate-300 hover:text-indigo-500 p-2 z-10"&gt;&lt;i data-lucide="settings-2" class="w-4 h-4"&gt;&lt;/i&gt;&lt;/button&gt;`;</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>let lowSpendHtml = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if(min &gt; 0) lowSpendHtml = `&lt;div class="mt-4 pt-3 border-t border-indigo-50/50"&gt;&lt;div class="flex justify-between items-end mb-1"&gt;&lt;div class="text-[10px] text-orange-400 font-bold uppercase tracking-wider"&gt;ä½æ¶ˆé–€æª»&lt;/div&gt;&lt;div class="text-[10px] text-slate-400 font-medium"&gt;ç›®æ¨™ $${min.toLocaleString()}&lt;/div&gt;&lt;/div&gt;&lt;div class="h-1.5 w-full bg-slate-100 rounded-full overflow-hidden mb-1 shadow-inner"&gt;&lt;div class="h-full bg-orange-400 progress-bar" style="width: ${minPercent}%"&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="text-right text-[10px] font-bold ${minRemaining &gt; 0 ? 'text-slate-400' : 'text-emerald-500'}"&gt;${minRemaining &gt; 0 ? 'å°šéœ€ $'+minRemaining.toLocaleString() : 'ğŸ‰ å·²é”æ¨™'}&lt;/div&gt;&lt;/div&gt;`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>// Display cycle info</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const cycleText = card.settings.cycleType === 'month' ? 'æ—¥æ›†æœˆ' : `æ¯æœˆ${card.settings.billDay}æ—¥çµ`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>el.innerHTML = `${setBtn}&lt;div class="flex items-center gap-2 mb-1"&gt;&lt;span class="bank-badge ${card.color}"&gt;${card.bank}&lt;/span&gt;&lt;span class="text-[10px] text-slate-400 bg-white/50 px-2 py-0.5 rounded backdrop-blur-sm font-medium"&gt;${cycleText}&lt;/span&gt;&lt;/div&gt;&lt;h3 class="font-bold text-slate-700 text-lg mb-4 serif-font tracking-wide"&gt;${card.name}&lt;/h3&gt;&lt;div class="flex justify-between items-end mb-2"&gt;&lt;div&gt;&lt;div class="text-[10px] text-indigo-400 font-bold mb-0.5 uppercase tracking-wider"&gt;æœ¬æœŸå›é¥‹æ¶ˆè²»&lt;/div&gt;&lt;div class="font-bold text-slate-700 text-xl tracking-tight serif-font"&gt;$${card.rewardSpent.toLocaleString()}&lt;/div&gt;&lt;/div&gt;&lt;div class="text-right"&gt;&lt;div class="text-[10px] text-slate-400 font-bold mb-0.5"&gt;é¡åº¦ ${cap &gt; 0 ? '$'+cap.toLocaleString() : '-'}&lt;/div&gt;&lt;div class="font-bold ${remaining !== null &amp;&amp; remaining &lt; 0 ? 'text-red-400' : 'text-emerald-500'} text-sm"&gt;${remaining !== null ? (remaining &gt;= 0 ? 'å‰© $'+remaining.toLocaleString() : 'è¶…é¡ $'+Math.abs(remaining).toLocaleString()) : 'âˆ'}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="h-2.5 w-full bg-slate-100 rounded-full overflow-hidden shadow-inner"&gt;&lt;div class="h-full ${barColor} progress-bar" style="width: ${capPercent}%"&gt;&lt;/div&gt;&lt;/div&gt;${lowSpendHtml}${txListHtml}`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>container.appendChild(el);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const pad = document.createElement('div'); pad.className = "h-12"; container.appendChild(pad);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// --- Settings Modal Logic (Fixing #4) ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.openSettingsModal = function(cardId, cardName) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>editingCardId = cardId;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>document.getElementById('settingsCardName').innerText = cardName;</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// Check for user-specific CSV bill day default</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const card = allCardsData.find(c =&gt; c.id === cardId);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>let csvBillDay = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(currentUser === 'Lynn' &amp;&amp; card &amp;&amp; card.lynnBillDay &gt; 0) csvBillDay = card.lynnBillDay;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>else if(currentUser === 'Andy' &amp;&amp; card &amp;&amp; card.andyBillDay &gt; 0) csvBillDay = card.andyBillDay;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// Load saved settings or default</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const saved = cardSettings[cardId];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const settings = saved || { cycleType: (csvBillDay &gt; 0 ? 'bill' : 'month'), billDay: (csvBillDay &gt; 0 ? csvBillDay : 1), customCap: 0, customMin: 0 };</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>document.getElementById('settingCap').value = settings.customCap || '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>document.getElementById('settingMin').value = settings.customMin || '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>document.getElementById('settingBillDay').value = settings.billDay;</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>setCycleMode(settings.cycleType);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>document.getElementById('settingsModal').classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.closeSettingsModal = function() {</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>document.getElementById('settingsModal').classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  </span>editingCardId = null;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.setCycleMode = function(mode) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const btnMonth = document.getElementById('btnCycleMonth');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const btnBill = document.getElementById('btnCycleBill');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const inputGroup = document.getElementById('billDateInputGroup');</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(mode === 'month') {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>btnMonth.classList.add('bg-indigo-500', 'text-white', 'border-indigo-500');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>btnMonth.classList.remove('bg-white', 'text-slate-600', 'border-slate-200');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>btnBill.classList.remove('bg-indigo-500', 'text-white', 'border-indigo-500');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>btnBill.classList.add('bg-white', 'text-slate-600', 'border-slate-200');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>inputGroup.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>btnBill.classList.add('bg-indigo-500', 'text-white', 'border-indigo-500');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>btnBill.classList.remove('bg-white', 'text-slate-600', 'border-slate-200');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>btnMonth.classList.remove('bg-indigo-500', 'text-white', 'border-indigo-500');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>btnMonth.classList.add('bg-white', 'text-slate-600', 'border-slate-200');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>inputGroup.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// store temp state if needed, or just read classes on save</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.saveCardSettings = function() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(!editingCardId) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const cycleType = document.getElementById('btnCycleMonth').classList.contains('bg-indigo-500') ? 'month' : 'bill';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const billDay = parseInt(document.getElementById('settingBillDay').value) || 1;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const customCap = parseFloat(document.getElementById('settingCap').value) || 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const customMin = parseFloat(document.getElementById('settingMin').value) || 0;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>cardSettings[editingCardId] = { cycleType, billDay, customCap, customMin };</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>localStorage.setItem(getStorageKey('card_settings'), JSON.stringify(cardSettings));</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>closeSettingsModal();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>renderView();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>showToast('âœ… è¨­å®šå·²å„²å­˜');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// --- HISTORY MODAL LOGIC (RESTORED) ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.openHistoryModal = function() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>document.getElementById('historyModal').classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const container = document.getElementById('historyListContainer');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>container.innerHTML = '';</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// Calc total</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>let total = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const sortedTxs = [...transactions].sort((a,b) =&gt; new Date(b.date) - new Date(a.date));</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(sortedTxs.length === 0) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>container.innerHTML = '&lt;div class="text-center text-slate-400 mt-10"&gt;æš«ç„¡æ¶ˆè²»ç´€éŒ„&lt;/div&gt;';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('historyTotalDisplay').innerText = '$0';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>sortedTxs.forEach(tx =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>total += parseFloat(tx.amount);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const el = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>el.className = "flex justify-between items-center p-3 bg-white border border-slate-100 rounded-xl shadow-sm active:scale-[0.99] transition-transform cursor-pointer";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>el.onclick = () =&gt; window.openTransactionModal(tx.id);</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>let catIcon = tx.category ? tx.category.split(' ')[0] : 'ğŸ“¦';</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>el.innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="flex items-center gap-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="w-10 h-10 rounded-full bg-slate-50 flex items-center justify-center text-lg"&gt;${catIcon}&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="text-xs text-slate-400 font-bold"&gt;${tx.date}&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="text-sm font-bold text-slate-700 truncate max-w-[150px]"&gt;${tx.item || tx.category}&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="text-right"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="text-sm font-bold text-indigo-600"&gt;$${parseFloat(tx.amount).toLocaleString()}&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="text-[10px] text-slate-400 truncate max-w-[80px]"&gt;${tx.note || ''}&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>container.appendChild(el);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>document.getElementById('historyTotalDisplay').innerText = `$${total.toLocaleString()}`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.closeHistoryModal = function() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>document.getElementById('historyModal').classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.loadSmallPayCsv = function(url) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>Papa.parse(url, {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>download: true, header: false, skipEmptyLines: true,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>complete: (results) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (results.data &amp;&amp; results.data.length &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const newStores = results.data.map(row =&gt; ({ name: row[0] || '', city: row[1] || 'å…¨å°', address: row[2] || '' })).filter(s =&gt; s.name &amp;&amp; s.name !== "ç‰¹ç´„å•†åº—åç¨±");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>// Add generics</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>SMALL_PAYMENT_CHAINS.forEach(c =&gt; newStores.push({ name: c, city: "å…¨å°", address: "å„åˆ†åº—" }));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>// De-dup</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const uniqueMap = new Map();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>newStores.forEach(item =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const key = item.name + (item.address || '');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (!uniqueMap.has(key)) uniqueMap.set(key, item);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>SMALL_PAYMENT_STORES_DB = Array.from(uniqueMap.values());</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('smallPayStats').innerText = `è³‡æ–™åº«ï¼š${SMALL_PAYMENT_STORES_DB.length} ç­†åº—å®¶`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.openAiChat = function() { document.getElementById('aiChatModal').classList.remove('hidden'); }</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.sendAiMessage = function() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const input = document.getElementById('aiInput');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const msg = input.value.trim().toLowerCase();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(!msg) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const chatBox = document.getElementById('aiChatContent');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>chatBox.innerHTML += `&lt;div class="flex gap-3 justify-end mb-4"&gt;&lt;div class="bg-pink-500 text-white p-3 rounded-2xl rounded-tr-none shadow-sm text-sm max-w-[80%]"&gt;${input.value}&lt;/div&gt;&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>input.value = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>chatBox.scrollTop = chatBox.scrollHeight;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const greetings = ['hi', 'hello', 'ä½ å¥½', 'æ—©å®‰', 'åˆå®‰', 'æ™šå®‰', 'å“ˆå›‰', 'è¬è¬', 'æ„Ÿæ©', 'æ²’äº†', 'æ°æ°'];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(greetings.some(g =&gt; msg.includes(g))) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>setTimeout(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>chatBox.innerHTML += `&lt;div class="flex gap-3 mb-4"&gt;&lt;div class="w-8 h-8 rounded-full bg-gradient-to-br from-pink-400 to-rose-400 flex items-center justify-center text-white flex-shrink-0"&gt;&lt;i data-lucide="bot" class="w-4 h-4"&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class="bg-white p-3 rounded-2xl rounded-tl-none shadow-sm text-sm text-slate-700 max-w-[80%]"&gt;ä½ å¥½å‘€ï¼ä»Šå¤©æƒ³åˆ·å“ªå¼µå¡å‘¢ï¼Ÿæˆ‘å¯ä»¥å¹«æ‚¨æ‰¾å„ªæƒ å–”ï¼ğŸ˜Š&lt;/div&gt;&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>chatBox.scrollTop = chatBox.scrollHeight;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>lucide.createIcons();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}, 600);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// 1. Detect Intent</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const smartMapping = {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>"é¤é£²": ["åƒ", "é¤“", "éº¥ç•¶å‹", "è‚¯å¾·åŸº", "æ¼¢å ¡ç‹", "æ‘©æ–¯", "æ˜Ÿå·´å…‹", "è·¯æ˜“è", "ç‹å“", "ç“¦åŸ", "è—å£½å¸", "å£½å¸éƒ", "ç«é‹", "ç‡’è‚‰", "ç‰›æ’", "èšé¤", "foodpanda", "ubereats", "é¥—é£Ÿå¤©å ‚", "æ¬£è‘‰", "50åµ", "äº”ååµ", "è¿·å®¢å¤", "å¯ä¸å¯", "æ¸…å¿ƒ", "coco", "èŒ¶æ¹¯æœƒ", "é¶´èŒ¶æ¨“", "éº»å¤", "å¤§è‹‘å­", "é£²æ–™", "å¥½å–", "å¥½æƒ³åƒ"],</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>"äº¤é€š": ["é«˜éµ", "å°éµ", "æ·é‹", "å…¬è»Š", "å®¢é‹", "åŠ æ²¹", "ä¸­æ²¹", "å°äº", "å…¨åœ‹", "åœè»Š", "uber", "è¨ˆç¨‹è»Š", "yoxi", "55688", "line taxi", "é€šå‹¤"],</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>"æ—…éŠ": ["æ©Ÿç¥¨", "é£¯åº—", "ä½å®¿", "è¨‚æˆ¿", "agoda", "booking", "hotels", "airbnb", "å‡ºåœ‹", "æ—¥æœ¬", "éŸ“åœ‹", "æ³°åœ‹", "æ­æ´²", "æ©Ÿå ´", "å…ç¨…", "æ—…è¡Œ"],</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>"ç¶²è³¼": ["è¦çš®", "momo", "pchome", "æ·˜å¯¶", "amazon", "é…·æ¾", "coupang", "yahoo", "éœ²å¤©", "åšå®¢ä¾†", "è²·æ±è¥¿", "ä¸‹å–®"],</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>"é›»å½±": ["å¨ç§€", "åœ‹è³“", "ç§€æ³°", "æ–°å…‰", "å–œæ¨‚æ™‚ä»£", "çœ‹æˆ²", "èœ˜è››äºº", "marvel", "é˜¿å‡¡é”", "é›»å½±"],</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>"æ”¯ä»˜": ["line pay", "è¡—å£", "apple pay", "google pay", "å°ç£pay", "æ‚ éŠä»˜", "å…¨ç›ˆ", "icash", "è¡Œå‹•æ”¯ä»˜"],</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>"è¶…å•†": ["7-11", "å…¨å®¶", "èŠçˆ¾å¯Œ", "ok", "ä¾¿åˆ©å•†åº—"]</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>let expandedKeywords = [msg];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>let detectedIntent = "";</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>for (const [category, keywords] of Object.entries(smartMapping)) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (keywords.some(k =&gt; msg.includes(k))) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>expandedKeywords.push(category);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if(category === "é¤é£²") expandedKeywords.push("é¤å»³");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if(category === "ç¶²è³¼") expandedKeywords.push("è³¼ç‰©");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>detectedIntent = category;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>break;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// 2. Check Small Payment</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>let smallPayWarning = "";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const isSmallPay = SMALL_PAYMENT_CHAINS.some(c =&gt; msg.includes(c.toLowerCase()));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const dbMatch = SMALL_PAYMENT_STORES_DB.find(s =&gt; msg.includes(s.name.toLowerCase()));</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (isSmallPay || dbMatch) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>smallPayWarning = `</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="bg-red-50 border border-red-100 p-2.5 rounded-xl mb-3 flex gap-2 items-start"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;i data-lucide="alert-triangle" class="w-4 h-4 text-red-500 mt-0.5 flex-shrink-0"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="text-xs text-red-600"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;b&gt;æ³¨æ„ï¼š&lt;/b&gt;ã€Œ${msg}ã€å±¬æ–¼å°é¡æ”¯ä»˜å¹³å°åå–®ï¼&lt;br&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>ç›´æ¥åˆ·å¡å¯èƒ½&lt;b&gt;æ²’æœ‰å›é¥‹&lt;/b&gt;ã€‚&lt;br&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>å»ºè­°ä½¿ç”¨ï¼šè¡—å£ / LinePay / å…¨æ”¯ä»˜ã€‚</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// 3. Search Cards (Enhanced Keyword Search from CSV)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>let results = [];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(allCardsData &amp;&amp; allCardsData.length &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>allCardsData.forEach(card =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>card.offers.forEach(offer =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>let score = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>let matchedReason = "";</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>// Check raw input first</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (offer.tags.some(t =&gt; t.toLowerCase().includes(msg))) { score += 5; matchedReason = msg; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (offer.desc.toLowerCase().includes(msg)) { score += 3; matchedReason = msg; }</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>// Then check expanded keywords</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if(score === 0) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>expandedKeywords.forEach(k =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (offer.tags.some(t =&gt; t.toLowerCase().includes(k))) { score += 4; matchedReason = k; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (offer.desc.toLowerCase().includes(k)) { score += 2; matchedReason = k; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>else if (offer.category.toLowerCase().includes(k)) { score += 3; matchedReason = k; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if (score &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const existing = results.find(r =&gt; r.cardName === card.name &amp;&amp; r.category === offer.category);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if(!existing) results.push({<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>cardName: card.name,<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>bank: card.bank,<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>rate: offer.rate,<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>desc: offer.desc,<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>category: offer.category,<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>score: score,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>reason: matchedReason,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>paymentMethod: offer.paymentMethod</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>setTimeout(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>let replyHtml = smallPayWarning;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if(results.length &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>results.sort((a, b) =&gt; b.rate - a.rate || b.score - a.score);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const topResults = results.slice(0, 5);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>let introText = `ğŸ” å¹«æ‚¨æ‰¾åˆ° &lt;b&gt;${results.length}&lt;/b&gt; ç­†ç›¸é—œå„ªæƒ `;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if(detectedIntent) introText += ` (å·²è‡ªå‹•æœå°‹ã€Œ${detectedIntent}ã€é¡åˆ¥)`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>introText += "ï¼š&lt;br&gt;&lt;br&gt;";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>replyHtml += introText;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>topResults.forEach(r =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const payMethodHtml = r.paymentMethod ? `&lt;span class="text-[9px] bg-yellow-50 text-orange-500 px-1 py-0.5 rounded border border-yellow-100 ml-1"&gt;é™ ${r.paymentMethod}&lt;/span&gt;` : '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>replyHtml += `&lt;div class="mb-3 pb-3 border-b border-slate-100 last:border-0 last:mb-0 last:pb-0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="flex justify-between items-start"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="font-bold text-indigo-600 text-sm"&gt;ğŸ’³ ${r.bank} ${r.cardName}&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;span class="text-lg font-bold text-pink-500 flex-shrink-0"&gt;${r.rate}%&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="flex items-center gap-2 mt-1 flex-wrap"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;span class="text-[10px] bg-slate-100 px-1.5 py-0.5 rounded text-slate-500 font-bold"&gt;${r.category}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>${payMethodHtml}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>${r.reason ? `&lt;span class="text-[9px] bg-green-50 text-emerald-500 px-1.5 py-0.5 rounded font-bold border border-green-100"&gt;ğŸ’¡ å‘½ä¸­: ${r.reason}&lt;/span&gt;` : ''}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;div class="text-xs text-slate-400 mt-1 leading-snug"&gt;${r.desc}&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>replyHtml += `ğŸ¤” å—š... é‡å°ã€Œ${msg}ã€æˆ‘æ‰¾ä¸åˆ°æ˜ç¢ºçš„å„ªæƒ è³‡æ–™è€¶ã€‚&lt;br&gt;&lt;br&gt;è©¦è©¦çœ‹æœå°‹åˆ¥çš„ï¼Ÿä¾‹å¦‚ï¼šã€Œé¤å»³ã€ã€ã€Œç¶²è³¼ã€ã€‚`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>chatBox.innerHTML += `&lt;div class="flex gap-3 mb-4"&gt;&lt;div class="w-8 h-8 rounded-full bg-gradient-to-br from-pink-400 to-rose-400 flex items-center justify-center text-white flex-shrink-0"&gt;&lt;i data-lucide="bot" class="w-4 h-4"&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class="bg-white p-4 rounded-2xl rounded-tl-none shadow-sm text-sm text-slate-700 max-w-[85%]"&gt;${replyHtml}&lt;/div&gt;&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>chatBox.scrollTop = chatBox.scrollHeight;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>lucide.createIcons();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}, 800);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.onSmallPayInput = function(val) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const input = val.trim().toLowerCase();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const suggestionsBox = document.getElementById('smallPaySuggestions');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const resultDiv = document.getElementById('smallPayResult');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (input.length &lt; 1) { suggestionsBox.classList.add('hidden'); resultDiv.classList.add('hidden'); return; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const matches = SMALL_PAYMENT_STORES_DB.filter(s =&gt; s.name.toLowerCase().includes(input)).slice(0, 15);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (matches.length &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>let html = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>matches.forEach(m =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const regex = new RegExp(`(${val})`, 'gi');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>const highlight = m.name.replace(regex, '&lt;span class="suggestion-match"&gt;$1&lt;/span&gt;');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>html += `&lt;div class="suggestion-item" onclick="selectSuggestion('${m.name}')"&gt;&lt;span class="truncate pr-2"&gt;${highlight}&lt;/span&gt;&lt;span class="suggestion-city whitespace-nowrap"&gt;${m.city}&lt;/span&gt;&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>suggestionsBox.innerHTML = html;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>suggestionsBox.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>} else { suggestionsBox.classList.add('hidden'); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.selectSuggestion = function(val) { document.getElementById('smallPayInput').value = val; document.getElementById('smallPaySuggestions').classList.add('hidden'); checkSmallPay(val); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.clearSmallPaySearch = function() { document.getElementById('smallPayInput').value = ''; document.getElementById('smallPaySuggestions').classList.add('hidden'); document.getElementById('smallPayResult').classList.add('hidden'); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.checkSmallPay = function(inputVal) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const input = inputVal || document.getElementById('smallPayInput').value.trim();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const resultDiv = document.getElementById('smallPayResult');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(!input) { resultDiv.classList.add('hidden'); return; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const match = SMALL_PAYMENT_STORES_DB.find(s =&gt; s.name === input || s.name.includes(input));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>resultDiv.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(match) { resultDiv.innerHTML = `&lt;div class="bg-red-50 border border-red-200 rounded-xl p-4 flex gap-3 items-start animate-pulse"&gt;&lt;i data-lucide="alert-triangle" class="w-6 h-6 text-red-500 flex-shrink-0 mt-0.5"&gt;&lt;/i&gt;&lt;div&gt;&lt;h3 class="font-bold text-red-600 text-lg mb-1"&gt;é€™æ˜¯å°é¡æ”¯ä»˜å¹³å°ï¼&lt;/h3&gt;&lt;p class="text-xs text-red-500 font-bold leading-relaxed"&gt;ã€Œ${match.name}ã€(${match.city}) å±¬æ–¼å°é¡æ”¯ä»˜åå–®ã€‚&lt;br&gt;âš ï¸ ç›´æ¥åˆ·å¡å¯èƒ½&lt;span class="underline"&gt;ç„¡å›é¥‹&lt;/span&gt;ã€‚&lt;br&gt;&lt;span class="text-[10px] text-slate-400 mt-1 block"&gt;åœ°å€: ${match.address}&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;`; }<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>else { const isChain = SMALL_PAYMENT_CHAINS.some(c =&gt; input.includes(c)); if(isChain) { resultDiv.innerHTML = `&lt;div class="bg-red-50 border border-red-200 rounded-xl p-4"&gt;&lt;h3 class="font-bold text-red-600 text-lg"&gt;âš ï¸ é€£é–åº—æ³¨æ„&lt;/h3&gt;&lt;p class="text-xs text-red-500"&gt;æ­¤å“ç‰Œé€šå¸¸ç‚ºå°é¡æ”¯ä»˜ï¼Œè«‹ç¢ºèªã€‚&lt;/p&gt;&lt;/div&gt;`; } else { resultDiv.innerHTML = `&lt;div class="bg-emerald-50 border border-emerald-200 rounded-xl p-4 flex gap-3 items-start"&gt;&lt;i data-lucide="check-circle-2" class="w-6 h-6 text-emerald-500 flex-shrink-0 mt-0.5"&gt;&lt;/i&gt;&lt;div&gt;&lt;h3 class="font-bold text-emerald-600 text-lg mb-1"&gt;æœªåˆ—åœ¨åå–®ä¸­&lt;/h3&gt;&lt;p class="text-xs text-emerald-500 font-bold leading-relaxed"&gt;è³‡æ–™åº«ç„¡ã€Œ${input}ã€ç´€éŒ„ã€‚&lt;br&gt;æ‡‰å¯äº«æœ‰å›é¥‹ã€‚&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;`; } }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>lucide.createIcons();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.filterSmallPayByCity = function() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const city = document.getElementById('smallPayCitySelect').value;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const resultDiv = document.getElementById('smallPayResult');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(!city) { resultDiv.classList.add('hidden'); return; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const localStores = SMALL_PAYMENT_STORES_DB.filter(s =&gt; s.city === city || s.city === 'å…¨å°');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>let html = `&lt;div class="bg-white border border-slate-200 rounded-xl p-3 max-h-60 overflow-y-auto space-y-2"&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(localStores.length &gt; 0) { localStores.forEach(s =&gt; { html += `&lt;div class="flex justify-between items-center text-xs border-b border-slate-100 pb-2 last:border-0 last:pb-0"&gt;&lt;span class="font-bold text-slate-700"&gt;${s.name}&lt;/span&gt;&lt;span class="text-slate-400 text-[10px] truncate max-w-[150px]"&gt;${s.address}&lt;/span&gt;&lt;/div&gt;`; }); } else { html += `&lt;div class="text-center text-slate-400 py-4"&gt;ç„¡è³‡æ–™&lt;/div&gt;`; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>html += `&lt;/div&gt;`; resultDiv.innerHTML = html; resultDiv.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>function checkScroll() { const btn = document.getElementById('btnBackToTop'); if(window.scrollY &gt; 200) btn.classList.add('show'); else btn.classList.remove('show'); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.addEventListener('scroll', checkScroll);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>function getCycleRange(settings, refDate) { const year = refDate.getFullYear(), month = refDate.getMonth(), day = refDate.getDate(); let start, end; if (settings.cycleType === 'month') { start = new Date(year, month, 1); end = new Date(year, month + 1, 0); } else { const billDay = parseInt(settings.billDay) || 1; if (day &gt; billDay) { start = new Date(year, month, billDay + 1); end = new Date(year, month + 1, billDay); } else { start = new Date(year, month - 1, billDay + 1); end = new Date(year, month, billDay); } } return { start: start.toISOString().split('T')[0], end: end.toISOString().split('T')[0] }; }</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// --- TRANSACTION FUNCTIONS ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.openTransactionModal = function(existingTxId = null) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const select = document.getElementById('txCardSelect'); select.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>let sortedCards = [...allCardsData];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(manageCardFilter) { sortedCards.sort((a,b) =&gt; (a.id === manageCardFilter ? -1 : 1)); }</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// Add a placeholder option</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const defaultOpt = document.createElement('option');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>defaultOpt.value = "";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>defaultOpt.text = "è«‹é¸æ“‡å¡ç‰‡";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>defaultOpt.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>defaultOpt.selected = true;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>select.appendChild(defaultOpt);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>sortedCards.forEach(c =&gt; { const opt = document.createElement('option'); opt.value = c.id; opt.text = `${c.bank} - ${c.name}`; select.appendChild(opt); });</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const btnDel = document.getElementById('btnDeleteTx');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const title = document.getElementById('txModalTitle');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (existingTxId) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const tx = transactions.find(t =&gt; t.id === existingTxId);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (tx) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>editingTransactionId = tx.id;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>title.innerText = "ä¿®æ”¹æ¶ˆè²»ç´€éŒ„";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('txCardSelect').value = tx.cardId;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('txAmount').value = tx.amount;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('txDate').value = tx.date;</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if(tx.category) {</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('txCategory').value = tx.category;</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('txItem').value = tx.item || '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('txCategory').value = "ğŸ“¦ å…¶ä»–";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('txItem').value = tx.item || '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('txNote').value = tx.note || '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('checkReward').checked = tx.types.includes('reward');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('checkGeneral').checked = tx.types.includes('general');</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>// --- V75 Fix: FORCE DISPLAY BLOCK AND REMOVE HIDDEN ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>btnDel.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>btnDel.style.display = 'block';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>btnDel.onclick = function() { window.openDeleteConfirm(); };</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>editingTransactionId = null;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>title.innerText = "è¨˜ä¸€ç­†æ¶ˆè²»";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('txAmount').value = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('txCategory').value = "ğŸ½ï¸ é¤é£²";<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('txItem').value = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('txNote').value = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('checkReward').checked = true;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('checkGeneral').checked = false;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('txDate').valueAsDate = new Date();</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if(currentView === 'manage' &amp;&amp; manageCardFilter) {</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>document.getElementById('txCardSelect').value = manageCardFilter;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>// --- V75 Fix: FORCE DISPLAY NONE AND ADD HIDDEN ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>btnDel.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>btnDel.style.display = 'none';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>document.getElementById('transactionModal').classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.closeTransactionModal = function() { document.getElementById('transactionModal').classList.add('hidden'); }</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.saveTransaction = async function() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (!currentUser) return alert('è«‹å…ˆé¸æ“‡ä½¿ç”¨è€…èº«åˆ† (è¨­å®š &gt; é¸æ“‡èº«åˆ†)');</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const cardId = document.getElementById('txCardSelect').value;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const amount = parseFloat(document.getElementById('txAmount').value);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const date = document.getElementById('txDate').value;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const category = document.getElementById('txCategory').value;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const item = document.getElementById('txItem').value;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const note = document.getElementById('txNote').value;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const types = [];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(document.getElementById('checkReward').checked) types.push('reward');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(document.getElementById('checkGeneral').checked) types.push('general');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// --- VALIDATION ALERT ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const missing = [];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (!cardId) missing.push("ä¿¡ç”¨å¡");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (isNaN(amount) || amount &lt;= 0) missing.push("é‡‘é¡");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (!date) missing.push("æ—¥æœŸ");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (!category) missing.push("é¡åˆ¥");</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (missing.length &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>alert(`è«‹è¨˜å¾—å¡«å¯«ä»¥ä¸‹æ¬„ä½å–”ï¼š\n${missing.join('ã€')}`);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>showLoading(true, "é›²ç«¯åŒæ­¥ä¸­...");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>await new Promise(r =&gt; setTimeout(r, 50));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>let txData = { cardId, amount, date, category, item, note, types, timestamp: Date.now() };</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (editingTransactionId) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>const index = transactions.findIndex(t =&gt; t.id === editingTransactionId);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if (index !== -1) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>txData.id = editingTransactionId;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>transactions[index] = txData;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>txData.id = Date.now().toString();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>transactions.push(txData);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>localStorage.setItem(getStorageKey('transactions'), JSON.stringify(transactions));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>await postToCloud(txData, 'save');<span class="Apple-converted-space">Â </span></p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>showLoading(false);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>showToast('âœ… å·²æ›´æ–°');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>closeTransactionModal();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>renderView();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(!document.getElementById('historyModal').classList.contains('hidden')) window.openHistoryModal();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.openDeleteConfirm = function() { document.getElementById('deleteConfirmModal').classList.remove('hidden'); }</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>window.executeDelete = async function() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (!currentUser) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>document.getElementById('deleteConfirmModal').classList.add('hidden');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>showLoading(true, "é›²ç«¯åˆªé™¤ä¸­...");</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>transactions = transactions.filter(t =&gt; t.id !== editingTransactionId);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>localStorage.setItem(getStorageKey('transactions'), JSON.stringify(transactions));</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// --- V74: Ensure payload is correct for delete action ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>await postToCloud({id: editingTransactionId}, 'delete');<span class="Apple-converted-space">Â </span></p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>showToast('âœ… åˆªé™¤æˆåŠŸ');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>showLoading(false);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>closeTransactionModal();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>renderView();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(!document.getElementById('historyModal').classList.contains('hidden')) window.openHistoryModal();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>document.getElementById('bankSelect').addEventListener('change', (e) =&gt; { currentBankFilter = e.target.value; currentCardFilter = ''; const s=document.getElementById('cardSelect'); s.innerHTML='&lt;option value=""&gt;æ‰€æœ‰å¡ç‰‡&lt;/option&gt;'; if(currentBankFilter) { allCardsData.filter(c=&gt;c.bank===currentBankFilter).forEach(c=&gt;{const o=document.createElement('option');o.value=c.name;o.text=c.name;s.appendChild(o)});s.disabled=false;}else s.disabled=true; renderView(); });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>document.getElementById('cardSelect').addEventListener('change', (e) =&gt; { currentCardFilter = e.target.value; renderView(); });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>document.getElementById('manageCardFilter').addEventListener('change', (e) =&gt; { manageCardFilter = e.target.value; renderView(); });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>document.getElementById('searchInput').addEventListener('input', (e) =&gt; { document.getElementById('clearBtn').style.display = e.target.value ? 'block' : 'none'; if(currentView === 'search') renderView(); });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>document.getElementById('clearBtn').addEventListener('click', () =&gt; { document.getElementById('searchInput').value = ''; document.getElementById('clearBtn').style.display = 'none'; renderView(); });</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>init();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
